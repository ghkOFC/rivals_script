local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- CONFIGURAÇÕES
local settings = {
    espEnabled = false,
    aimbotEnabled = false,
    killauraEnabled = false,
    noclipEnabled = false,
    triggerbotEnabled = false,
    aimPart = "Head",
    aimFov = 150,
    killauraRange = 10,
    killauraDelay = 0.5,
}

-- GUI
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "TestToolsGUI"

local yOffset = 10
local function createToggleButton(name, callback)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 140, 0, 30)
    button.Position = UDim2.new(0, 10, 0, yOffset)
    button.Text = name .. ": OFF"
    button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Parent = ScreenGui
    button.MouseButton1Click:Connect(function()
        settings[name] = not settings[name]
        button.Text = name .. ": " .. (settings[name] and "ON" or "OFF")
        callback(settings[name])
    end)
    yOffset = yOffset + 40
end

createToggleButton("espEnabled", function() end)
createToggleButton("aimbotEnabled", function() end)
createToggleButton("killauraEnabled", function() end)
createToggleButton("noclipEnabled", function() end)
createToggleButton("triggerbotEnabled", function() end)

-- FOV Circle (Aimbot)
local fovCircle = Drawing.new("Circle")
fovCircle.Thickness = 1
fovCircle.Transparency = 1
fovCircle.Color = Color3.fromRGB(255, 255, 255)
fovCircle.Filled = false
fovCircle.Visible = false

-- ESP
local espTable = {}
local function createESP(player)
    if player == LocalPlayer then return end
    local text = Drawing.new("Text")
    text.Size = 14
    text.Center = true
    text.Outline = true
    text.Color = Color3.fromRGB(255, 0, 0)
    text.Visible = false
    espTable[player] = text
end
local function removeESP(player)
    if espTable[player] then espTable[player]:Remove(); espTable[player] = nil end
end
Players.PlayerAdded:Connect(function(p)
    p.CharacterAdded:Connect(function() wait(1) createESP(p) end)
end)
Players.PlayerRemoving:Connect(removeESP)
for _, p in ipairs(Players:GetPlayers()) do
    if p ~= LocalPlayer and p.Character then
        createESP(p)
        p.CharacterAdded:Connect(function() wait(1) createESP(p) end)
    end
end

-- Aimbot
local rightClick = false
UserInputService.InputBegan:Connect(function(i)
    if i.UserInputType == Enum.UserInputType.MouseButton2 then rightClick = true end
end)
UserInputService.InputEnded:Connect(function(i)
    if i.UserInputType == Enum.UserInputType.MouseButton2 then rightClick = false end
end)
local function getClosestEnemyInFov()
    local closest, shortest = nil, settings.aimFov
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Team ~= LocalPlayer.Team and p.Character and p.Character:FindFirstChild(settings.aimPart) then
            local pos, onScreen = Camera:WorldToViewportPoint(p.Character[settings.aimPart].Position)
            if onScreen then
                local dist = (Vector2.new(pos.X, pos.Y) - Camera.ViewportSize / 2).Magnitude
                if dist < shortest then
                    shortest = dist
                    closest = p.Character[settings.aimPart]
                end
            end
        end
    end
    return closest
end

-- KillAura
local lastAttack = 0
local function getClosestInRange()
    local closest, shortest = nil, settings.killauraRange
    local myPos = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not myPos then return nil end
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Team ~= LocalPlayer.Team and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            local dist = (p.Character.HumanoidRootPart.Position - myPos.Position).Magnitude
            if dist < shortest then
                shortest = dist
                closest = p
            end
        end
    end
    return closest
end
local function attack(target)
    local tool = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Tool")
    if tool and tool:FindFirstChild("Activate") then
        tool:Activate()
    else
        local hum = target.Character and target.Character:FindFirstChild("Humanoid")
        if hum then hum:TakeDamage(10) end
    end
end

-- NoClip
RunService.Stepped:Connect(function()
    if settings.noclipEnabled and LocalPlayer.Character then
        for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
            if part:IsA("BasePart") and part.CanCollide then
                part.CanCollide = false
            end
        end
    end
end)

-- Triggerbot
local function getTargetUnderCrosshair()
    local unitRay = Camera:ScreenPointToRay(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    local ray = Ray.new(unitRay.Origin, unitRay.Direction * 1000)
    local part, pos = workspace:FindPartOnRay(ray, LocalPlayer.Character, false, true)
    if part then
        local model = part:FindFirstAncestorOfClass("Model")
        if model and Players:GetPlayerFromCharacter(model) and Players:GetPlayerFromCharacter(model) ~= LocalPlayer then
            return Players:GetPlayerFromCharacter(model)
        end
    end
    return nil
end

-- Loop Principal
RunService.RenderStepped:Connect(function()
    -- ESP
    for player, text in pairs(espTable) do
        local head = player.Character and player.Character:FindFirstChild("Head")
        if settings.espEnabled and head and player.Team ~= LocalPlayer.Team then
            local pos, onScreen = Camera:WorldToViewportPoint(head.Position)
            if onScreen then
                text.Position = Vector2.new(pos.X, pos.Y - 20)
                text.Text = player.Name
                text.Visible = true
            else
                text.Visible = false
            end
        else
            text.Visible = false
        end
    end

    -- Aimbot
    fovCircle.Visible = settings.aimbotEnabled
    fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    fovCircle.Radius = settings.aimFov

    if settings.aimbotEnabled and rightClick then
        local target = getClosestEnemyInFov()
        if target then
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, target.Position)
        end
    end

    -- KillAura
    if settings.killauraEnabled and tick() - lastAttack >= settings.killauraDelay then
        local target = getClosestInRange()
        if target then
            attack(target)
            lastAttack = tick()
        end
    end

    -- Triggerbot
    if settings.triggerbotEnabled then
        local target = getTargetUnderCrosshair()
        if target then
            attack(target)
        end
    end
end)
